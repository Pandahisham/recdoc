Interactive registration of 2D histology and 3D CT data for assessment of radiofrequency ablation treatment

Histological investigation of a lesion induced by radiofrequency ablation (RFA) treatment provides ground-truth about the true lesion size, thus verifying the success or failure of the RFA treatment. This work presents a framework for registration of two-dimensional large-scale histological sections and three-dimensional CT data typically used to guide the RFA intervention. The focus is on the developed interactive methods for reconstruction of the histological volume data by fusion of histological and high-resolution CT (MicroCT) data and registration into CT data based on natural feature points. The framework is evaluated using RFA interventions in a porcine liver and applying medically relevant metrics. The results of registration are within clinically required precision targets; thus the developed methods are suitable for validation of the RFA treatment.

Liver cancer is the fifth most common cancer and third most common cause of cancer death worldwide. Only 10-20% of the patients can undergo surgical resection, whereas the rest may benefit from the RFA treatment, which is becoming standard for small tumors.[1]
During RFA a high-frequency electrical current passes through a needle-like electrode, heats, and above certain temperature, destroys the surrounding tissue (tumor or not tumor alike). In organs such as liver, that lesion can be highly irregular due to large blood vessels acting as heat sinks in which the heat is dissipating locally.[2] Therefore, reliable monitoring of the size of the lesion during or right after RFA would significantly increase the safety of RFA and reduce the chances of tumor re-occurrence. Histology is the gold standard for assessing the lesion but hardly available in patients. Instead, standard imaging modalities such as ultrasound, MRI, and most often, CT are used for monitoring under the assumption of a known correlation between visible features and histological lesion.[3] Another viable approach is the simulation of the RFA induced lesion where validation against the true histological lesion is also desirable.[4]
Both applications, monitoring and simulation, would benefit from a correct assessment of the histological lesion, which requires registration of the histological and the three-dimensional in vivo data. In routinely used in vivo contrast enhanced CT imaging, the RFA lesion is visible as hypodense nonenhancing region (dark) surrounded by a variable hyperemic rim (bright border, typically about 5-10 mm thick) on portal venous phase images [Figure 1a]. The approximate correlation between histological and CT lesion was investigated before. Typically the assessment was based on manually measured size and volume of histological and CT lesion and visual comparison of single slices.[25] Both are obviously inadequate descriptors for typical complex-shaped lesions in the liver. In consequence, the relation between CT features and histology is only weakly defined at the most crucial transition region between alive and dead tissue, the hyperemic rim.
Histology processing pipeline with introduced deformations and associated registration steps for lesion reconstruction. Image data show (left) example slices and (right) the approximate scale of (a) in vivo CT (portal venous phase), (b) MicroCT, and (c) histology. (All data are enhanced for visualization.)
In this paper, we describe a framework for interactive reconstruction of the histological lesion and registration into in vivo CT data [Figure 1]. All registration steps are based solely on nonlesion features so that a well-defined correlation is established between lesion features visible in CT and the “true” histological lesion. The framework consists of a segmentation stage, where foreground, vessels, and lesion are identified, and two interactive registration stages. Firstly, the histology slides are registered to a high-resolution ex vivo CT (MicroCT) scan of the uncut histology block to correctly reconstruct the histological lesion. Secondly, the recovered histology block is registered into the in vivo CT. In both steps, only segmented foreground masks and vessels are used to establish correspondence to avoid introducing the correlation of lesion features we want to analyze.
Similar multistage approaches were used to register in vivo MRI and histology of human prostate[6] or to register CT and histology for assessing carotid plaques in humans.[7] Automatic registration was based on mutual information metric of the whole image, which is not applicable here since it would introduce unwanted correspondence between lesion features. In most closely related work, Breen et al.[8] used a similar framework for registering in vivo MRI and histology of the RFA lesion in rabbit thigh to investigate the correspondence between MRI lesion and histological lesion. Since no distinctive features were visible in both modalities they introduced artificial landmarks, which are visible in MR and histology.
The focus of this paper is on the overall framework and the registration steps which are explained in detail. Segmentation is briefly outlined. Qualitative and quantitative evaluation is performed for a porcine liver to demonstrate the suitability of the methods for establishing a well-defined correlation between histological and CT features.
Three-phase contrast-enhanced CT images are taken in vivo before sacrificing a pig and extracting the liver for histology creation [Figure 1a]. Data are prepared as described.[9] MicroCT data [Figure 1b] are taken after embedding in paraffin but before slicing; CAB(Chromotrop Anilinblue) stained histology slides (2 μm thick) are obtained at 100 μm intervals to reduce preparation work but retain lesion details [Figure 1c].
The framework consists of a segmentation stage for fore-/background and vessels in CT, MicroCT, and histology followed by two major registration steps. The segmented vessels are used in the registration to define the correspondence between the different imaging modalities independent of visible lesion features. Firstly, each histology slide is semiautomatically registered onto the corresponding MicroCT slice using free-form deformation, thus reconstructing the histology volume. Secondly, CT and MicroCT vessels are interactively registered assuming similarity transformation. The result is the registration of the histology block in the coordinate system of the in vivo CT data. The lesion is typically divided into one to four blocks for histology processing. These blocks are combined in a final step, and, if necessary, gaps are interpolated over using the standard linear method.
A semiautomatic hybrid based on multiscale vessel enhancement combined with ridge-oriented region growing and skeleton-based post-processing is used for CT vessel segmentation.[10] The method is adapted for MicroCT data by introducing further preprocessing steps. Firstly, the region of interest is coarsely separated using hard thresholding and morphological hole filling. To handle large variations in vessel appearance (filled with paraffin (gray) or air filled (black)), the filtered image is constructed through fusion of enhanced images. Parameter-controlled pruning is used to remove spurious components.
Structures in histology (foreground, vessels) are segmented using a standard Gaussian mixture model approach.[11] Parameters (i.e., image feature(s), number of mixture modes, smoothing factor, label to mode mapping) of the algorithm are set from manually annotated slides by choosing parameters that maximize the accuracy of the pixel classification. The binary classification results are morphologically refined. The automatic registration of histology and MicroCT relies on a robust segmentation of large vessels (>10 mm). Therefore, those candidates are further filtered. For that, neighboring slides (four) are automatically registered using a standard multiresolution method with normalized mutual information metric and rigid transform in ITK (www.itk.org). Vessels candidates are deleted if they are not segmented in at least two of the neighbors. For evaluation purposes, the histology lesion and the CT lesion were manually segmented using an in-house tool and ITK-SNAP[12] respectively. If necessary, the same tools are used for manual refinement of vessel segmentation in MicroCT and histology.
Fully automatic and reliable registration of histology and MicroCT data is impossible in our application due to the extreme deformations, tears and destructions of the histological slides and, most of all, the necessity to consider only the segmented vessels for correspondence. Therefore, we developed an interactive registration tool for histology and MicroCT data. Thin-plate-splines (TPS) are used as typical choice to model soft tissue deformations.[68] Moreover, TPS interpolation enables comprehensible manual refinement since the deformation is directly calculated by matching sets of corresponding points.
In a first step, correspondence between histology slides and MicroCT slices is established. Histology slides with representative and easily identifiable feature points on vessels (e.g., bifurcation points) are chosen from both ends of the histology stack. Corresponding feature points in the MicroCT volume are manually selected. Those points define the approximate cutting plane and allow rotating and resampling the MicroCT so that each histology slide has a corresponding slice in the transformed MicroCT volume. For that, we assume that the histology slide spacing is nearly uniform, which is valid since a MicroCT slice is 25 times (55 μm) as thick as a histology slide (2 μm).
The second step is the semiautomatic TPS registration of each histology slide onto its corresponding MicroCT slice in 2D. For automatic initialization, vessel feature masks are created for each modality (foreground pixels have value 1, background and vessel pixels have value 0). Those masks are registered using a standard multiresolution method with affine transform and the relative overlap as metric (Kappa-Statistic in ITK www.itk.org). The initial set of corresponding points for TPS is automatically extracted as the centers of matching vessels in registered MicroCT and histology. For an adequate registration it is necessary to have an approximately uniform distribution of corresponding points over the whole slide, especially around the lesion (which will be explained in detail). But only large vessels are automatically segmented in MicroCT. Therefore, the further points are interactively selected in the histological slide and corresponding MicroCT slice until the registration is satisfactory. It is of note that the standard ITK/VTK implementation of TPS performs interpolation rather than approximation, i.e., the set of corresponding points matches exactly after the transform. Therefore, one can match any structures as accurate as needed by choosing the appropriate landmark points. For example, gaps in the tissue can be closed by choosing a large number of points along the rift. That enables us to assume that the elastic properties of the tissue are locally uniform instead of globally, as typically assumed for TPS registration. Thus, a satisfactory registration is typically reached by manually selecting matching points around the lesion, near the lesion border.
The liver extraction process is designed to avoid large nonrigid deformations of the histology block before slicing. The MicroCT is taken after embedding the liver block into paraffin, which dehydrates and shrinks the tissue by 10-20% in length. Initial experiments show a nearly uniform shrinkage; therefore, similarity transform is used as the deformation model. The registration is, again, based only on segmented vessels.
The large difference in scale leads to two problems that prevent a fully automatic registration. Firstly, the MicroCT shows only a small part of the liver leading to a huge parameter search space. Secondly, only a small number of vessels are large enough to be visible in CT and small enough to be seen in MicroCT – thus putting only weak constraints on the registration problem. Therefore, a software tool is used for interactive registration of the vessel meshes. The user selects corresponding points on the vessel meshes and the transformation is automatically calculated and applied to the visualization.
Full lesion reconstruction and registration process with evaluation was performed for data of a 1-week surviving pig with a lesion divided into two histology blocks.
Results of all framework steps are shown in Figures 2–4 (3D visualization with MITK (www.mitk.org)). Three typical histological slices together with corresponding MicroCT slices and overlaid lesion segmentation are shown in Figure 2. Histology and MicroCT registration results in a reconstructed histological volume [Figures 3a–b] and lesion in the MicroCT coordinate system [Figure 3c]. Interactive registration of CT vessels and MicroCT vessels is based on a small number of identified vessel correspondences [Figure 4b]. After recombination of histology blocks, the registered lesions are in very good agreement [Figure 4a]. Note, in particular, the vessels fitting well in the indentations of the lesion [Figures 4c–d]. The medically relevant aspect is the overlay of the histological lesion in the in vivo CT [Figures 4e–f]. For that single example, the CT lesion underestimates the histological lesion.
Histology registration: (a) original, (b) registered histology, (c) corresponding MicroCT slice with registered histological lesion (enhanced for visualization)
MicroCT–histology registration: (a) reconstructed histology volume in coronal, sagittal, transversal view; (b) histology volume in volumetric view; (c) MicroCT with reconstructed histological lesion and segmented vessels
CT–MicroCT registration: (a) manually segmented CT lesion (green) and reconstructed histological lesion (yellow); (b) manually selected corresponding vessels (white annotation marks correspondence) (MicroCT vessel (green), CT vessels (hepatic artery (red), portal vein (blue), hepatic vein (light blue))); (c,d) histological lesion registered into CT vessel tree; (e) CT, portal venous phase, with overlaid lesions and vessel segmentations; (f) reconstructed histological volume with overlaid lesions and vessel segmentations (contours of CT lesion (green), histology lesion (yellow), and CT vessels)
Ultimately medically relevant is the distance between the surfaces of reconstructed and “true” lesion since it describes the quality of the reconstruction in the transition zone between living and dead tissue – which is of utmost clinical interest since tumor reoccurrence is mainly due to surviving tumor cells in that region. Since the ground-truth lesion is not accessible, the performance is evaluated based on interobserver variations in the lesion contours assessed as average (AD) and maximum (MD) symmetric surface distance in the CT spatial domain (i.e., after registration into the CT to make the distances comparable). Considering the large number of histological slices (176), a small representative subset (every fifth slice) was segmented and registered twice for evaluation of the histology reconstruction. Registration into CT was also performed twice for both histology blocks.
Results for histology reconstruction and registration into CT are summarized in Table 1. In both stages, histology reconstruction and registration into CT, the average precision is better than 0.5 mm and less than 1.7 mm in worst case. For comparison, automatic affine registration of histology and MicroCT – which was used to initialize the TPS registration – has a much larger worst case precision of 2.7 mm, indicating the need for manual refinement. The vessel segmentation algorithm in CT data was extensively evaluated in Ref.[10]. The average segmentation error for vessels typically visible in CT and MicroCT (diameter < 7 mm) was about 1 mm. For MicroCT vessels, the same algorithm and additional manual refinement were used to ensure similar average accuracy. Maximum errors are of minor interest here, since these variations are averaged when using similarity transform in the CT–MicroCT registration.
Quantitative results over all steps. Statistics of average (AD) and maximum (MD) surface distances between manually segmented lesion contours are presented as mean value±standard deviation in mm in the CT domain. The surface distance of manually repeated segmented CT lesion is given for comparison
Accurate assessment of the combined accuracy overall segmentation and registrations steps is challenging without ground-truth. In the worst case, the maximum variations sum up to the final error (4.95 mm=1.30 + 1.65 + 2.00 (vessel segmentation, expected value)), which is similar to the maximal error between two manual CT lesion segmentations (4.01 mm) and also between reconstructed histology lesion and manually segmented CT lesion (5.46 mm). But in general, the final error will be closer to the single maximum variation introduced in the MicroCT–CT registration step.
Establishing a well-defined correlation between true histological lesion and lesion visible in CT data is required for correct validation of RFA simulation as well as for improved monitoring of RFA treatment. The result of our framework is a fully reconstructed histological lesion, registered into the CT coordinate system. Obviously, that allows a more accurate assessment of the correlation of histological and CT lesion than using comparison of single slices[25] – in particular in the liver where the heat sink effect leads to complex-shaped lesions.
Evaluation results indicate that the average precision of the whole framework is smaller than 2 mm, which compares favorably to CT resolution (0.4 mm) and is similar to the manual lesion segmentation in CT. Even the worst-case error is smaller than 5 mm which is the typical clinical safety margin by which the lesion should surround the tumor after the RFA treatment.
In similar frameworks, quantitative evaluation is often sparse at best. For registration of the RFA lesion in rabbit thigh, Breen et al.[8] reported an average error of 1.32±0.39 mm for histology to ex vivo block photograph registration which is the equivalent step to our MicroCT–Histology registration, and an average surface distance between reconstructed histological and MRI lesion of 1.04±0.43 mm. Park et al.[6] reported an average registration error of 3 mm measured as difference between manually segmented histology and MRI lesion. Overall the performances are very similar, which also indicates that our evaluation is valid, although only based on one processed data set.
The major drawback of our approach is the amount of manual work needed for interactive registration of histology and MicroCT, which also hinders an extensive evaluation with many data sets. However, accurate automatic registration is almost impossible due to strong deformations and the restrain that only vessels features are used. Furthermore, the histology preparation with its slicing and staining procedures is even more time consuming so that it is extremely important that we achieve the best possible reconstruction and registration results.
We have presented a framework for interactive registration of ex vivo histology data and in vivo CT data. Evaluation indicates that the overall achieved precision is adequate for an accurate assessment of the correlation of histological and CT lesion. In particular, since only nonlesion features are used for registration, our framework provides the means for establishing a well-defined correspondence between the true histological lesion and the visible lesion in CT after RFA. That again is necessary to improve monitoring of the RFA outcome and will help us to accurately validate RFA simulation.[4]
A conclusion of the true correspondence between histological and CT lesion cannot be reached from one data set but future work will improve on that. Furthermore, we will introduce another ex vivo MicroCT scan of a larger histology block including the whole lesion before embedding in paraffin. Firstly, that will remove the shrinkage due to dehydration as source of uncertainty. Secondly, a larger block will contain more reference vessels for establishing correspondence between CT and MicroCT to reduce the – subjectively – highest uncertainty lies.
